<div style="align: right;"><a href="http://mt.makezine.com/cgi-bin/mt/mt-search.cgi?blog_id=1&Template=tag_display&tag=@codebox"><img src="http://blog.makezine.com/upload/2010/09/MZ_Codebox.gif" width="600" height="70" alt="MZ_Codebox.gif"/></a></div>
<p>
This Codebox explores how to use a web server to collect sensor data from a Processing sketch.  As an example, we'll use OpenCV to periodically detect and report number of faces that appear in your webcam's field of view.  You might use something like this at a conference or art show to see how many people are interested in a particular session or exhibit.  Using this data feed, you might then create a mobile app that would show you where the most people are at a conference at any given time.
<p>
<strong>Set up the web server</strong>
<p>
You'll need access to a web server with <a href=-"http://www.php.net/">PHP</a> to do this project.  (PHP is a scripting language for creating web sites is offered by almost every hosting company.) If you don't have an account with a hosting company, you can simply set up a web server on your own machine.  In fact, most new Macs come with <a href="http://httpd.apache.org/">Apache</a>,  one of the most popular web servers, pre-installed.  All you have to do is activate it, which you can do through your computer's "System Preferences" panel.  Just open the preferences, click "Sharing," and then check the "Web Sharing" from the list at the left. (If you're on Windows, you'll need to install an external server.  I've had great success with <a href="http://www.apachefriends.org/en/xampp.html">XAMPP</a>, which has everything you'll need.) 
<p>
If all goes well, you'll see the "Web Sharing: On" status indicator light up in green.  You'll also see the address you can use in your browser to access the "root" of your web site.  (Make a note of this address, as we'll need it later in the Processing sketch.)  The following figure shows you more detail:
<p>
<img src="http://blog.makezine.com/ano_enable_mac_webserver_113010.png" width="600" height="430" alt="ano_enable_mac_webserver_113010.png" />
<p>
Once sharing is enabled, you're ready to set up the PHP script that will log the data.  This is done by adding a few files in the web server's root directory.  On a Mac, this is usually the "Sites" directory, which is in the same spot as your Music, Movies, and Documents directories.  <p>
To start setting up the script, drop into a terminal and type these commands: <p>
<code>
<pre>
cd ~/Sites/
mkdir face_sensor
cd face_sensor
touch sensor_log.txt
chmod 777 sensor_log.txt
</pre>
</code>
In this sequence of commands, we're changing to the "root" directory where the Mac's webserver expects to find files, creating a new directory called "face_sensor," and then adding a blank log file that our PHP script can write to.  This last step happens in two parts: the first is the use of the <i>touch</i> command to create a new, empty log file.  The second step is to use the <i>chmod</i> command to set the permissions on the file so that PHP can write data to the file.
<p>
<p>
Next, you need to configure your system so that the server can execute PHP scripts.  <a href="http://stackoverflow.com/users/158895/serpicolugnut">SerpicoLugNut</a> on Stackoverflow has a great description of how to do this at <a href="http://stackoverflow.com/questions/1293484/easiest-way-to-activate-php-and-mysql-on-mac-os-10-6-snow-leopard">Easiest way to activate PHP and MySQL on Mac OS 10.6 (Snow Leopard)?</a>.  Here's what he says to do:
<p>
<pre>
<i>
Open a good text editor (I'd recommend TextMate, but the free TextWrangler or vi or nano will do too), and open:

/etc/apache2/httpd.conf

Find the line: "#LoadModule php5_module libexec/apache2/libphp5.so"

And uncomment it (remove the #).
</i>
</pre>
<p>
Once the directory is ready, save the following PHP to a file called <i>record.php</i>:
<p>
<object data="http://makezine.googlecode.com/svn/trunk/processing/networked_face_sensor/record.php" type="text/plain" width="600" style="height: 300px; background-color: #cccccc"></object>
<p>
Once you've copied the file, go to your browser and enter the following URL:
<p>
<code>
http://<i>your personal website address from the sharing panel</i>/face_sensor/record.php?face_count=5&room_name=ballroom&interval=2000
</code>
<p>
Your browser should say "OK."  If you open the <i>sensor_log.txt</i> file, you should see a line that looks like this:
<p>
<code>
01-12-2010 06:01:41 EST	ballroom	5	2000
</code>
<p>
So, what's happening?  Basically, the PHP script is simply pulling out the values we're put in the URL's <a href="http://en.wikipedia.org/wiki/Query_string">query string</a> (e.g., face_count, room_name, and interval) and writing them out to a tab-delimited file.  That's it.  (Well, OK, it's also adding the date and time.)  
<p>
In a "real" system, you'd most likely write these values to a database, but that's beyond the scope of this post -- what mainly want to do is show you how to use Processing to send data to a web site, not the particulars of how that web site records the data.  If you're interested in going further on the back end piece, Kevin Yank's article <a href="http://articles.sitepoint.com/article/php-amp-mysql-1-installation">Build Your Own Database Driven Web Site Using PHP & MySQL, Part 1: Installation</a> is a good place to start.
<p>

<strong>Set up the sketch</strong>
<p>
Now that the web server is set up and is able to log data, the next step is to build the Processing sketch that detects faces and reports them back to your server.  Before you start, make sure that you've installed the <a href="http://www.sojamo.de/libraries/controlP5/">controlP5</a> and the <a href="http://ubaa.net/shared/processing/opencv/">OPENCV Processing</a> external libraries.  (If you're unfamiliar with external libraries, check out <a href="http://answers.oreilly.com/topic/331-how-to-import-libraries-in-processing/">How to Import Libraries in Processing</a> on <a href="http://answers.oreilly.com/">O'Reilly Answers</a>.) Once the libraries are installed, fire up Processing and paste the code for <a href="http://makezine.googlecode.com/svn/trunk/processing/networked_face_sensor/networked_face_sensor.pde">networked_face_sensor.pde</a> into the sketch window:
<p>
<object data="http://makezine.googlecode.com/svn/trunk/processing/networked_face_sensor/networked_face_sensor.pde" type="text/plain" width="600" style="height: 600px; background-color: #cccccc"></object>
<p>
In addition, you'll need to modify the <i>transmission_url</i> to set it to the address of your PHP script.  The line 
<p>
<code>
String transmission_url = "http://MacOdewahn.home/~odewahn/face_sensor/record.php";
</code>
<p>
must be updated to
<p>
<code>
String transmission_url = "http://<i>your personal website address from the sharing panel</i>/face_sensor/record.php";
</code>
<p>
When you start the sketch, you'll notice that you must first pick the source video you want to use, which is done with the command <i>cam.settings();</i>.  This allows you to hook up an external web camera, rather than just use the built-in webcam.  After you've selected the source, you should see the video feed.  
<p>
The face detection and reporting process occurs every 2 seconds, as specified in the <i>interval</i> variable.  You can also enter a "room name" so that you you can distinguish the multiple data sources.  For example, you might have one camera running in your living room, and one in your kitchen, with both reporting back to the same central server.
<p>
After a few seconds or so, you can open the log in your web browser and see the data that your sensors have reported.  The URL for this is:
<p>
<code>
http://<i>your personal website address from the sharing panel</i>/face_sensor/sensor_log.txt
</code>
<p>
It will look something like this:
<p>
<img src="http://blog.makezine.com/ano_sensor_log_120110.png" width="600" height="413" alt="ano_sensor_log_120110.png" />
<p>
<strong>Discussion</strong>
<p>
As you can see, the Processing code is very similar to the projects we've explored in other posts.  Basically, all we're doing here is adding a new method, called <i>transmit()</i>, to report the data back to the server.  <i>transmit()</i>'s job is to create a URL with all information that is required by our PHP script.  Note how each field name in the query string -- face_count, interval, and room_name -- is consistently used in both the Processing and PHP script:
<p>
<img src="http://blog.makezine.com/ano_processing_to_php_113010.png" width="600" height="195" alt="ano_processing_to_php_113010.png" />
<p>
Once we have this URL, Processing's built in <i><a href="http://processing.org/reference/loadStrings_.html">loadStrings()</a></i> command executes the PHP script on our server to save the information.  Note that we don't actually care about the results in this example; only that the page is called.  However, if we wanted to get more sophisticated, we could have the PHP script return a status code or some other information.
<p>
The final point worth noting is how we've used Java's <a href="http://download.oracle.com/javase/1.4.2/docs/api/java/net/URLEncoder.html">URLEncoder</a> utility class to encode each of the fields.  This ensures that the data is correctly transmitted to the server.  Once again, we're taking advantage of some of the powerful goodies that are available in Java to make our life in Processing much easier!
<p>
<p><strong>In the Maker Shed:</strong></p>
<a href="http://www.makershed.com"><img src="http://blog.craftzine.com/makershedsmall.jpg" height="45" width="200" alt="Makershedsmall" /></a></br>
<div style="align: right;"><img src="http://blog.makezine.com/upload/2010/09/our_latest_make_book--getting_start/processingCover.jpg"  width="193" height="300" alt="processingCover.jpg"/></div><a href="http://www.makershed.com/ProductDetails.asp?ProductCode=9781449379803">Getting Started with Processing</a>
Learn computer programming the easy way with Processing, a simple language that lets you use code to create drawings, animation, and interactive graphics. Programming courses usually start with theory,but this book lets you jump right into creative and fun projects.  It's ideal for anyone who wants to learn basic programming, and  serves as a simple introduction to graphics for people with some programming skills. </p>