<div style="align: right;"><a href="http://mt.makezine.com/cgi-bin/mt/mt-search.cgi?blog_id=1&Template=tag_display&tag=@codebox"><img src="http://blog.makezine.com/upload/2010/09/MZ_Codebox.gif" width="600" height="70" alt="MZ_Codebox.gif"/></a></div>
<p>
Autocomplete is one Google's many interesting features. For example, if you start typing "How do I make" into the search box, Google presents a top-10 list of things that it thinks that you might be searching for. Generated by analyzing millions of similar searches, this collective "wisdom of the crowds" can be hilarious, tragic, or deeply indicative of the human condition. Often, it's all of these at once.
<p>
This sketch lets you explore the Google zeitgeist of a phrase you select. It works like this.  When you enter a phrase like  "How do I make," the sketch creates 26 variations by adding each letter of the alphabet at the end: "how do i make a," "how do i make b," "how do i make c," and so on.  It then queries Google for each variation and adds the ten results to a running list. Befitting the inherent drama of seeing the hopes, dreams, and aspirations of millions, the 260 results are presented as an iconic "Star Wars" scroll:

<p><iframe src="http://player.vimeo.com/video/16389375" width="601" height="473" frameborder="0"></iframe></p>
<p><strong>The Autocomplete API</strong></p>
<p>Autocomplete is powered by a relatively simple URL that looks like this.</p>
<pre>
<p>http://google.com/complete/search?output=toolbar&amp;q=<i>encoded search term</i></p>
</pre>
<p>
Unlike most pages you visit, which present pretty HTML, this one returns XML data that is meant for machines to read.  Known as an Application Programming Interface (API), this incredibly powerful technique allows programs to easily communicate across a network. Without an API, we'd have to go to Google, type in our phrase 26 times, and then collect all the results by hand.  The API lets us do this automatically.
<p>
To get the underlying XML data for the "How do i make" suggestions, all you have to do is visit this URL:</p>
<pre>
<a href="http://google.com/complete/search?output=toolbar&amp;q=How+do+i+make">http://google.com/complete/search?output=toolbar&amp;q=how+do+i+make</a>
</pre>
<p>
If you "View Source" on your web browser, you'll see some XML that looks something like this (although I've formatted this example to be more readable):
<p>
<pre>
&lt;?xml version="1.0"?&gt;
&lt;toplevel&gt;
  &lt;CompleteSuggestion&gt;
    &lt;suggestion data='how do i make my hair grow faster' /&gt;
    &lt;num_queries int='300000' /&gt;
  &lt;/CompleteSuggestion&gt;
  &lt;CompleteSuggestion&gt;
    &lt;suggestion data='how do i make a heart on facebook' /&gt;
    &lt;num_queries int='200000000' /&gt;
  &lt;/CompleteSuggestion&gt;
  ...
  &lt;CompleteSuggestion&gt;
    &lt;suggestion data='how do i make a group on facebook' /&gt;
    &lt;num_queries int='970000000' /&gt;
  &lt;/CompleteSuggestion&gt;
&lt;/toplevel&gt;
</pre>
<p>
We'll use Processing's <i>XMLElement()</i> library to read this XML data to create the scrolling text.
<p>
<strong>Set up the Sketch</strong>
<p>
First, though, let's get the sketch running.  Since we're using the <a href="http://www.sojamo.de/libraries/controlP5/">controlP5</a> library to get the query phrase, you'll need to have that library installed and configured.  (If you don't, the controlP5 section of <a href="http://blog.makezine.com/archive/2010/10/codebox_create_a_fractal_menagerie.html">Codebox: Create a fractal menagerie</a> will tell you how to set it up.)  You can grab the sketch's source code from the box below or from the <a href="http://code.google.com/p/makezine/source/browse/trunk/processing/zeitgeist/zeitgeist.pde">zetigeist.pde</a> file.
<p>
<object data="http://makezine.googlecode.com/svn/trunk/processing/zeitgeist/zeitgeist.pde" type="text/plain" width="600" style="height: 600px; background-color: #cccccc"></object>
<p>
Once you've gotten the source code into Processing, start the sketch and type in a phrase.  After a few seconds, you should see the results start scrolling across the screen a la Star Wars.  (If you don't enter any text, the sketch will simply present the most popular results for all general queries.)
<p>
<strong>Discussion</strong> 
<p>
So, how does this thing work?  There are a few key elements: 

<ol>
<li>It grabs a batch of data from the Autocomplete API</li>
<li>It parses the XML with <i>XMLElement()</i> and save the results</li>
<li>It displays the results as a scrolling list</li> 
</ol>
<p>
So, let's talk about how to grab the data from the API.  Processing's <i>loadStrings()</i> function allows you to grab the text of any URL, so all we have to do is present the Autocomplete API with a properly formatted query.  To do this, we'll use Java's <i>URLEncoder</i> library (remember, everything you can use in Java is fair game for Processing) to write the <i>encode()</i> function, which <a href="http://en.wikipedia.org/wiki/Percent-encoding">encodes</a> the text entered into the <i>userQuery</i> box.
<p>
The <i>getSuggestions()</i> function uses our <i>encode()</i> function to fetch the page and parse the XML results.  The function uses the <i><a href="http://processing.org/reference/XMLElement.html">XMLElement()</a></i> object to work with the results.  Like most XML libraries, this one uses a "family tree" like syntax to allow you to access the various data elements. As shown in the next figure, the suggestion data is the first child element (&lt;suggestion&gt;) under of root element's children (&lt;CompleteSuggestion&gt;).  
<p>
<img src="file://localhost/Users/odewahn/Library/Application%20Support/ecto3/cache/AD72AAAA-9700-4200-97E1-DD879ADB1C53.png" width="600" height="191" alt="ano_suggest_xml_110110.png" />
<p>
Since the actual text is help in the attribute, we use the <i>getStringAttribute()</i> function to pull out the data we want.  [<b>Note</b>: that this syntax is different than the official documentation, but this post on Processing's community forum, <a href="http://forum.processing.org/topic/xmlelement-problem-function-getint-getstring-does-not-exist">XMLElement problem: function getInt/getString 'does not exist'</a> provides the details.]  Once we've grabbed the text of the suggestion, we'll append it to the <i>suggestionList</i> ArrayList.
<p>
Finally, it's worth explaining a bit about how we actually call the <i>getSuggestions()</i> function.  As you'll see, it's actually called in the <i>draw()</i> method, which is a bit unusual.  Initially, I tried to slurp up all 26 query variants at once by making a series of rapid hits against Autocomplete.  I quickly hit the API's <i>rate limit</i>, which is the maximum number of times per second that you can use it at any given time.  In addition, there was a long pause at the start of the sketch that I didn't like.  
<p>
So, instead, I added a timer called <i>timeBetweenFetches</i> so that the API was only called every 5 seconds.  Since the text is scrolling by rather slowly, this allowed the results to buffer up over time, leading to a smoother overall look without violating Google's requirements.  Each time we hit the API, we advance a counter that tells us which letter of the alphabet to add to the base query.  Once we get the results, we reset the timer.  There's also a bit of logic in there to test if the user has typed in a new query term and pressed the <i>findButton</i>.
<p>  
The other piece of the <i>draw()</i> method handles the scrolling text.  To do this, we use a variable called <i>y</i> to hold the y-coordinate of the first string in <i>suggestionList</i>.  We then loop through each element in the list, and write the text on the screen in reference to the variable <i>y</i>, which is decremented on each pass through <i>draw()</i>.  This gives us the nice, scrolling effect.  (We also center the text on the x-axis, which is done with a simple formula.)
<p>
Finally, the Star Wars effect is easily achieved by using Processing's built-in <a href="http://processing.org/learning/3d/">3D Graphics Library</a> to rotate the plane of the X-Axis by a few degrees.  This was a neat hack that I saw on <a href="http://www.openprocessing.org/portal/?userID=2128">Luis Gonzalez</a>'s "<a href="http://www.openprocessing.org/visuals/?visualID=4167">Star Wars</a>" sketch on <a href="http://www.openprocessing.org/">openprocesing.org</a>.  I highly recommend this site as a source for inspiration and ideas.
<p>
<p><strong>In the Maker Shed:</strong></p>
<a href="http://www.makershed.com"><img src="http://blog.craftzine.com/makershedsmall.jpg" height="45" width="200" alt="Makershedsmall" /></a></br>
<div style="align: right;"><img src="http://blog.makezine.com/upload/2010/09/our_latest_make_book--getting_start/processingCover.jpg"  width="193" height="300" alt="processingCover.jpg"/></div><a href="http://www.makershed.com/ProductDetails.asp?ProductCode=9781449379803">Getting Started with Processing</a>
Learn computer programming the easy way with Processing, a simple language that lets you use code to create drawings, animation, and interactive graphics. Programming courses usually start with theory,but this book lets you jump right into creative and fun projects.  It's ideal for anyone who wants to learn basic programming, and  serves as a simple introduction to graphics for people with some programming skills. </p>


